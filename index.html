<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä¸€ç›´åœ¨æƒ³ä½ </title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <style>
    :root {
      --color-main: #4A0A8A;
      --color-main-grad: #6A0DAD;
      --color-deep-purple: #2D0047;
      --color-dark-blue: #0A0028;
      --color-cyan: #00ffff;
      --color-white: #ffffff;
      --color-pink: #ff6b9d;
      --color-shadow1: #00ffff;
      --color-shadow2: #6a0dad;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      min-height: 100vh;
      min-width: 100vw;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, var(--color-dark-blue) 0%, var(--color-deep-purple) 40%, var(--color-main) 80%, var(--color-main-grad) 100%);
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "STKaiti", "Segoe UI", Arial, cursive, sans-serif;
      color: var(--color-white);
    }

    body {
      position: relative;
      overflow: hidden;
      overscroll-behavior: none;
    }

    /* èƒŒæ™¯å…ƒç´  */
    #bgCanvas, #particleCanvas {
      position: fixed;
      left: 0; 
      top: 0; 
      z-index: 0;
      width: 100vw !important;
      height: 100vh !important;
      display: block;
    }

    .stars-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: 
        radial-gradient(2px 2px at 20px 30px, #eee, transparent),
        radial-gradient(2px 2px at 40px 70px, #fff, transparent),
        radial-gradient(1px 1px at 90px 40px, #fff, transparent),
        radial-gradient(1px 1px at 130px 80px, #fff, transparent),
        radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
      background-repeat: repeat;
      background-size: 200px 100px;
      opacity: 0.3;
      animation: twinkle 4s infinite alternate;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 0.4; }
    }

    /* ä¸»è¦å†…å®¹åŒºåŸŸ */
    .main-content {
      position: absolute;
      left: 50%; 
      top: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 800px;
      z-index: 3;
      text-align: center;
      user-select: none;
      pointer-events: none;
    }

    .love-saying {
      font-size: 3.5em;
      font-weight: bold;
      color: var(--color-pink);
      letter-spacing: .16em;
      padding-bottom: .15em;
      text-shadow:
        0 0 30px var(--color-shadow1),
        0 0 25px var(--color-shadow2),
        2px 3px 2px #0005;
      animation: romancePulse 2.8s infinite cubic-bezier(.77,0,.17,1);
      background: linear-gradient(90deg, var(--color-pink) 10%, var(--color-cyan) 90%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 1em;
    }
    
    @keyframes romancePulse {
      0% { transform:translateY(0) scale(1);}
      45%{ transform:translateY(-12px) scale(1.12);}
      100%{transform:translateY(0) scale(1);}
    }

    /* å€’è®¡æ—¶æ ·å¼ - æ•°å­—å­—ä½“å¤§å°é€’å¢ */
    .love-time {
      padding: 1.5em 0.8em;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 
        0 0 40px 6px rgba(0, 255, 255, 0.25) inset,
        0 0 60px 4px rgba(255, 107, 157, 0.3);
      mix-blend-mode: normal;
      transition: all .3s;
      animation: floatText 4.8s ease-in-out infinite alternate;
      display: block;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(15px);
      border: 3px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 2em;
    }
    
    .time-line {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0.5em 0;
      line-height: 1.2;
    }
    
    .time-label {
      font-size: 1.2em;
      font-weight: 600;
      color: var(--color-white);
      text-shadow: 0 0 10px var(--color-cyan);
      margin-right: 0.5em;
    }
    
    /* æ•°å­—å­—ä½“å¤§å°é€’å¢ */
    .time-value {
      font-weight: 800;
      color: var(--color-cyan);
      text-shadow: 0 0 15px var(--color-cyan);
    }
    
    .days-value {
      font-size: 3.5em; /* æœ€å¤§ */
    }
    
    .hours-value {
      font-size: 3em;
    }
    
    .minutes-value {
      font-size: 2.5em;
    }
    
    .seconds-value {
      font-size: 2em;
    }
    
    .milliseconds-value {
      font-size: 1.5em; /* æœ€å° */
    }

    @keyframes floatText {
      0%   { transform:translateY(0);}
      40%  { transform:translateY(-6px);}
      100% { transform:translateY(0);}
    }

    /* å¤§çˆ±å¿ƒæ ·å¼ - ä¿®å¤ç§»åŠ¨ç«¯æ˜¾ç¤º */
    .heart-container {
      position: relative;
      width: 100%;
      height: 180px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 0.5em;
    }
    
    .heart {
      position: absolute;
      width: 140px;
      height: 126px;
      animation: heartbeat 1.2s infinite ease-in-out;
      filter: drop-shadow(0 0 25px rgba(255, 107, 157, 0.9));
      z-index: 2;
      transform-origin: center;
      /* ç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ­£ç¡®æ˜¾ç¤º */
      -webkit-transform-origin: center;
      -moz-transform-origin: center;
    }
    
    /* ä½¿ç”¨SVGæ–¹å¼åˆ›å»ºçˆ±å¿ƒï¼Œå…¼å®¹æ€§æ›´å¥½ */
    .heart svg {
      width: 100%;
      height: 100%;
      fill: #ff6b9d;
      filter: drop-shadow(0 0 15px rgba(255, 107, 157, 0.8));
    }
    
    @keyframes heartbeat {
      0% {
        transform: scale(1);
      }
      5% {
        transform: scale(1.1);
      }
      10% {
        transform: scale(1.15);
      }
      15% {
        transform: scale(1.2);
      }
      50% {
        transform: scale(1);
      }
      100% {
        transform: scale(1);
      }
    }
    
    .heart-pulse {
      position: absolute;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: rgba(255, 107, 157, 0.3);
      animation: pulse 1.2s infinite;
      z-index: 1;
      transform-origin: center;
      -webkit-transform-origin: center;
      -moz-transform-origin: center;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(0.8);
        opacity: 0.7;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.3;
      }
      100% {
        transform: scale(1.4);
        opacity: 0;
      }
    }

    /* æ‰“å¡ä¾¿ç­¾æŒ‰é’® */
    .note-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 12px 24px;
      background: rgba(255, 107, 157, 0.8);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      z-index: 10;
      box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
      transition: all 0.3s;
      pointer-events: auto;
    }
    
    .note-button:hover {
      background: rgba(255, 107, 157, 1);
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255, 107, 157, 0.7);
    }

    /* ä¾¿ç­¾å¼¹çª— */
    .note-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .note-modal.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .note-content {
      background: rgba(30, 0, 50, 0.95);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 0 50px rgba(255, 107, 157, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
    }
    
    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 10px;
    }
    
    .note-title {
      font-size: 1.8em;
      color: var(--color-pink);
      margin: 0;
    }
    
    .close-button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5em;
      cursor: pointer;
      padding: 5px;
    }
    
    .week-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .nav-button {
      background: rgba(255, 107, 157, 0.6);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .nav-button:hover {
      background: rgba(255, 107, 157, 0.9);
    }
    
    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .week-title {
      font-size: 1.2em;
      color: var(--color-cyan);
    }
    
    .note-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .note-item {
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      border-left: 4px solid var(--color-pink);
    }
    
    .note-date {
      font-weight: bold;
      color: var(--color-cyan);
      margin-bottom: 5px;
    }
    
    .note-text {
      color: white;
    }

    /* å…¨å±ç‰¹æ•ˆ */
    .fullscreen-effect {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .fullscreen-effect.active {
      opacity: 1;
    }
    
    .fullscreen-effect .effect-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 107, 157, 0.7) 0%, rgba(106, 13, 173, 0.8) 100%);
      animation: effectBgPulse 3s ease-out forwards;
    }
    
    @keyframes effectBgPulse {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      20% {
        transform: scale(1);
        opacity: 1;
      }
      80% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(1.2);
        opacity: 0;
      }
    }
    
    .fullscreen-effect .effect-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4em;
      color: white;
      text-shadow: 0 0 40px rgba(255, 255, 255, 0.9);
      animation: effectTextPulse 3s ease-out forwards;
      z-index: 101;
      text-align: center;
      font-weight: bold;
      white-space: pre-line;
      line-height: 1.4;
    }
    
    @keyframes effectTextPulse {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      30% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      70% {
        transform: translate(-50%, -50%) scale(1.1);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 0;
      }
    }

    /* ç‚¹å‡»åé¦ˆ */
    .touch-tip {
      position: fixed;
      left: 50%; 
      top: 50%;
      transform: translate(-50%,-50%);
      font-size: 1.3em;
      padding: 0.6em 1.8em;
      background: rgba(124,0,180,0.15);
      color: var(--color-cyan);
      border-radius: 99em;
      z-index: 30;
      pointer-events: none;
      opacity: 0;
      transition: .5s;
    }
    
    .touch-tip.show {
      opacity: 1;
    }

    /* çƒŸèŠ±ç²’å­ç‰¹æ•ˆ */
    .firework {
      position: fixed;
      pointer-events: none;
      z-index: 20;
    }

    /* å“åº”å¼è®¾è®¡ - ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º */
    @media (max-width: 768px) {
      .main-content {
        width: 95%;
      }
      
      .love-saying {
        font-size: 2.5em;
      }
      
      .love-time {
        padding: 1em 0.5em;
      }
      
      .days-value { font-size: 2.8em; }
      .hours-value { font-size: 2.4em; }
      .minutes-value { font-size: 2em; }
      .seconds-value { font-size: 1.6em; }
      .milliseconds-value { font-size: 1.2em; }
      
      /* ç§»åŠ¨ç«¯çˆ±å¿ƒå°ºå¯¸è°ƒæ•´ */
      .heart {
        width: 120px;
        height: 108px;
      }
      
      .heart-pulse {
        width: 150px;
        height: 150px;
      }
      
      .fullscreen-effect .effect-text {
        font-size: 2.5em;
      }
      
      .note-button {
        bottom: 20px;
        right: 20px;
        font-size: 1.1em;
        padding: 10px 20px;
      }
    }

    @media (max-width: 480px) {
      .love-saying {
        font-size: 2em;
      }
      
      .days-value { font-size: 2.2em; }
      .hours-value { font-size: 1.9em; }
      .minutes-value { font-size: 1.6em; }
      .seconds-value { font-size: 1.3em; }
      .milliseconds-value { font-size: 1em; }
      
      .time-label {
        font-size: 1em;
      }
      
      /* å°å±å¹•çˆ±å¿ƒå°ºå¯¸è°ƒæ•´ */
      .heart {
        width: 100px;
        height: 90px;
      }
      
      .heart-pulse {
        width: 130px;
        height: 130px;
      }
      
      .fullscreen-effect .effect-text {
        font-size: 2em;
      }
      
      .note-button {
        bottom: 10px;
        right: 10px;
        font-size: 0.9em;
        padding: 6px 12px;
      }
      
      .note-content {
        padding: 20px;
      }
    }

    @media (max-width: 360px) {
      /* è¶…å°å±å¹•è¿›ä¸€æ­¥è°ƒæ•´ */
      .heart {
        width: 80px;
        height: 72px;
      }
      
      .heart-pulse {
        width: 110px;
        height: 110px;
      }
      
      .love-saying {
        font-size: 1.8em;
      }
    }

    /* éšè—æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>
<body>
  <!-- æ·±é‚ƒæ˜Ÿç©ºèƒŒæ™¯ -->
  <div class="stars-background"></div>
  
  <!-- èƒŒæ™¯Canvas -->
  <canvas id="bgCanvas"></canvas>
  <canvas id="particleCanvas"></canvas>

  <!-- å…¨å±ç‰¹æ•ˆ -->
  <div class="fullscreen-effect" id="fullscreenEffect">
    <div class="effect-bg"></div>
    <div class="effect-text" id="effectText">ğŸ’–</div>
  </div>

  <!-- æ‰“å¡ä¾¿ç­¾å¼¹çª— -->
  <div class="note-modal" id="noteModal">
    <div class="note-content">
      <div class="note-header">
        <h2 class="note-title">æƒ³ä½ çš„æ¯ä¸€å¤© ğŸ’Œ</h2>
        <button class="close-button" id="closeNote">âœ•</button>
      </div>
      <div class="week-navigation">
        <button class="nav-button" id="prevWeek">ä¸Šä¸€å‘¨</button>
        <div class="week-title" id="weekTitle">ç¬¬1å‘¨</div>
        <button class="nav-button" id="nextWeek">ä¸‹ä¸€å‘¨</button>
      </div>
      <ul class="note-list" id="noteList">
        <!-- ä¾¿ç­¾å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </ul>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <div class="main-content">
    <div class="love-saying">ä¸€ç›´åœ¨æƒ³ä½ </div>
    <div class="love-time" id="loveTime">
      <div class="time-line">
        <span class="time-label">æƒ³ä½ äº†</span>
      </div>
      <div class="time-line" style="height: 0.5em;"></div> <!-- é—´éš”è¡Œ -->
      <div class="time-line">
        <span class="time-value days-value" id="days">0</span>
        <span class="time-label">å¤©</span>
      </div>
      <div class="time-line">
        <span class="time-value hours-value" id="hours">00</span>
        <span class="time-label">å°æ—¶</span>
      </div>
      <div class="time-line">
        <span class="time-value minutes-value" id="minutes">00</span>
        <span class="time-label">åˆ†é’Ÿ</span>
      </div>
      <div class="time-line">
        <span class="time-value seconds-value" id="seconds">00</span>
        <span class="time-label">ç§’</span>
      </div>
      <div class="time-line">
        <span class="time-value milliseconds-value" id="milliseconds">000</span>
        <span class="time-label">æ¯«ç§’</span>
      </div>
    </div>
    <div class="heart-container">
      <div class="heart-pulse"></div>
      <div class="heart">
        <!-- ä½¿ç”¨SVGçˆ±å¿ƒï¼Œå…¼å®¹æ€§æ›´å¥½ -->
        <svg viewBox="0 0 32 29.6">
          <path d="M23.6,0c-3.4,0-6.3,2.7-7.6,5.6C14.7,2.7,11.8,0,8.4,0C3.8,0,0,3.8,0,8.4c0,9.4,9.5,11.9,16,21.2
          c6.1-9.3,16-12.1,16-21.2C32,3.8,28.2,0,23.6,0z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- æ‰“å¡ä¾¿ç­¾æŒ‰é’® -->
  <button class="note-button" id="noteButton">æ‰“å¡ä¾¿ç­¾ ğŸ’</button>
  
  <!-- ç‚¹å‡»åé¦ˆ -->
  <div class="touch-tip" id="tip">ç‚¹ä¸€ç‚¹ï¼Œæœ‰æƒŠå–œï½</div>

  <script>
    // é…ç½®å‚æ•°
    const CONFIG = {
      startDate: "2025-10-18T13:28:07",
      clickThreshold: 10,
      timeWindow: 10000, // 10ç§’æ—¶é—´çª—å£
    };

    // æ¯å¤©ä¸åŒçš„ç‰¹æ®Šæ¶ˆæ¯
    const dailyMessages = [
      "è€å©†ç­‰æˆ‘å›å®¶[æµæ³ª]\nå¥½æƒ³é©¬ä¸Šè§åˆ°ä½ ",
      "ä»Šå¤©ä¹Ÿæ˜¯è¶…çº§æƒ³ä½ çš„ä¸€å¤©\næ¯ä¸€ç§’éƒ½åœ¨æœŸå¾…é‡é€¢",
      "æˆ‘ä»¬çš„çˆ±è·¨è¶Šæ—¶ç©º\nè·ç¦»è®©æ€å¿µæ›´æµ“",
      "ä½ æ˜¯æˆ‘å¿ƒä¸­æœ€äº®çš„æ˜Ÿ\nç…§äº®æˆ‘å›å®¶çš„è·¯",
      "æƒ³ä½ çš„å¿ƒè·³å£°\néš”ç€å±å¹•ä½ å¬åˆ°äº†å—",
      "çˆ±ä½ çš„ç¬¬Nå¤©\næ¯ä¸€å¤©éƒ½æ¯”æ˜¨å¤©æ›´çˆ±ä½ ",
      "é©¬ä¸Šå°±èƒ½æ‹¥æŠ±ä½ äº†\nè¿™ä¸ªå¿µå¤´è®©æˆ‘å……æ»¡åŠ›é‡"
    ];

    // çŠ¶æ€ç®¡ç†
    const state = {
      clickTimestamps: [],
      currentWeek: 0,
      notes: JSON.parse(localStorage.getItem('loveNotes')) || [],
      effectTimeout: null
    };

    // DOM å…ƒç´ 
    const elements = {
      bgCanvas: document.getElementById('bgCanvas'),
      particleCanvas: document.getElementById('particleCanvas'),
      fullscreenEffect: document.getElementById('fullscreenEffect'),
      effectText: document.getElementById('effectText'),
      days: document.getElementById('days'),
      hours: document.getElementById('hours'),
      minutes: document.getElementById('minutes'),
      seconds: document.getElementById('seconds'),
      milliseconds: document.getElementById('milliseconds'),
      noteButton: document.getElementById('noteButton'),
      noteModal: document.getElementById('noteModal'),
      closeNote: document.getElementById('closeNote'),
      noteList: document.getElementById('noteList'),
      prevWeek: document.getElementById('prevWeek'),
      nextWeek: document.getElementById('nextWeek'),
      weekTitle: document.getElementById('weekTitle'),
      tip: document.getElementById('tip')
    };

    // åˆå§‹åŒ–
    function init() {
      setupBackground();
      setupParticles();
      setupEventListeners();
      startTimer();
      generateAllNotes();
      
      // æ£€æµ‹ç§»åŠ¨è®¾å¤‡å¹¶åº”ç”¨ç›¸åº”ä¼˜åŒ–
      detectMobileAndOptimize();
    }

    // æ£€æµ‹ç§»åŠ¨è®¾å¤‡å¹¶ä¼˜åŒ–
    function detectMobileAndOptimize() {
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      if (isMobile) {
        console.log("ç§»åŠ¨è®¾å¤‡æ£€æµ‹åˆ°ï¼Œåº”ç”¨ä¼˜åŒ–");
        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç§»åŠ¨è®¾å¤‡ç‰¹å®šçš„ä¼˜åŒ–
      }
    }

    // è®¾ç½®èƒŒæ™¯
    function setupBackground() {
      const bgCtx = elements.bgCanvas.getContext('2d');
      
      function resizeBgCanvas() {
        elements.bgCanvas.width = window.innerWidth;
        elements.bgCanvas.height = window.innerHeight;
      }
      
      resizeBgCanvas();
      window.addEventListener('resize', resizeBgCanvas);

      function drawBackground() {
        const w = elements.bgCanvas.width, h = elements.bgCanvas.height;
        
        // æ·±é‚ƒèƒŒæ™¯æ¸å˜
        const gradient = bgCtx.createLinearGradient(0, 0, w, h);
        gradient.addColorStop(0, "#0A0028");
        gradient.addColorStop(0.3, "#2D0047");
        gradient.addColorStop(0.7, "#4A0A8A");
        gradient.addColorStop(1, "#6A0DAD");
        
        bgCtx.fillStyle = gradient;
        bgCtx.fillRect(0, 0, w, h);
        
        // æµ®åŠ¨å…‰æ–‘
        for(let i = 1; i <= 6; i++) {
          const r = Math.abs(Math.sin(Date.now() / 4000 + i)) * 0.3 + 0.2;
          const gx = w * [0.1, 0.9, 0.7, 0.3, 0.8, 0.2][i - 1];
          const gy = h * [0.2, 0.3, 0.8, 0.6, 0.4, 0.7][i - 1];
          const grad = bgCtx.createRadialGradient(gx, gy, 0, gx, gy, r * w / 2);
          
          grad.addColorStop(0, "rgba(180,70,255,0.08)");
          grad.addColorStop(0.7, "rgba(106,13,173,0.05)");
          grad.addColorStop(1, "rgba(10,0,40,0)");
          
          bgCtx.beginPath();
          bgCtx.arc(gx, gy, r * w / 2, 0, 2 * Math.PI);
          bgCtx.fillStyle = grad;
          bgCtx.globalAlpha = 0.4;
          bgCtx.fill();
          bgCtx.globalAlpha = 1;
        }
        
        requestAnimationFrame(drawBackground);
      }
      
      drawBackground();
    }

    // è®¾ç½®ç²’å­ç³»ç»Ÿ
    function setupParticles() {
      const pCtx = elements.particleCanvas.getContext('2d');
      let dpr = window.devicePixelRatio || 1;
      
      function resizeParticleCanvas() {
        const w = window.innerWidth, h = window.innerHeight;
        elements.particleCanvas.width = w * dpr;
        elements.particleCanvas.height = h * dpr;
        elements.particleCanvas.style.width = w + 'px';
        elements.particleCanvas.style.height = h + 'px';
        pCtx.setTransform(1, 0, 0, 1, 0, 0);
        pCtx.scale(dpr, dpr);
      }
      
      resizeParticleCanvas();
      window.addEventListener('resize', resizeParticleCanvas);
      
      // ç®€åŒ–ç²’å­ç³»ç»Ÿ - åªç»˜åˆ¶çˆ±å¿ƒå½¢çŠ¶
      function drawParticles() {
        pCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
        
        // ç»˜åˆ¶ä¸€ä¸ªå¤§çš„çˆ±å¿ƒè½®å»“
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2 - 45;
        const size = Math.min(window.innerWidth, window.innerHeight) * 0.03;
        
        pCtx.beginPath();
        for(let t = 0; t <= 2 * Math.PI; t += 0.01) {
          const x = 16 * Math.pow(Math.sin(t), 3);
          const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
          pCtx.lineTo(centerX + x * size, centerY + y * size);
        }
        pCtx.closePath();
        pCtx.strokeStyle = 'rgba(255, 107, 157, 0.3)';
        pCtx.lineWidth = 2;
        pCtx.stroke();
        
        requestAnimationFrame(drawParticles);
      }
      
      drawParticles();
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬
    function setupEventListeners() {
      document.addEventListener('click', handleClick);
      document.addEventListener('touchstart', handleTouch, { passive: true });
      
      // ä¾¿ç­¾åŠŸèƒ½
      elements.noteButton.addEventListener('click', openNoteModal);
      elements.closeNote.addEventListener('click', closeNoteModal);
      elements.prevWeek.addEventListener('click', showPrevWeek);
      elements.nextWeek.addEventListener('click', showNextWeek);
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      elements.noteModal.addEventListener('click', (e) => {
        if (e.target === elements.noteModal) {
          closeNoteModal();
        }
      });
    }

    // å¤„ç†ç‚¹å‡»äº‹ä»¶
    function handleClick(event) {
      processInteraction(event.clientX, event.clientY);
    }

    // å¤„ç†è§¦æ‘¸äº‹ä»¶
    function handleTouch(event) {
      if(event.touches.length >= 1) {
        processInteraction(event.touches[0].clientX, event.touches[0].clientY);
      }
    }

    // å¤„ç†äº¤äº’
    function processInteraction(x, y) {
      const now = Date.now();
      
      // è®°å½•ç‚¹å‡»æ—¶é—´æˆ³
      state.clickTimestamps.push(now);
      
      // æ¸…ç†10ç§’å‰çš„ç‚¹å‡»è®°å½•
      state.clickTimestamps = state.clickTimestamps.filter(
        timestamp => now - timestamp <= CONFIG.timeWindow
      );
      
      // è®¡ç®—å½“å‰ç‚¹å‡»æ¬¡æ•°
      const clickCount = state.clickTimestamps.length;
      
      // æ˜¾ç¤ºç‚¹å‡»åé¦ˆ
      showClickFeedback(x, y);
      
      // è§¦å‘çƒŸèŠ±ç‰¹æ•ˆ
      createFirework(x, y);
      
      // æ£€æŸ¥æ˜¯å¦è§¦å‘ç‰¹æ®Šæ¶ˆæ¯ï¼ˆ10ç§’å†…ç‚¹å‡»10æ¬¡ï¼‰
      if (clickCount >= CONFIG.clickThreshold) {
        showDailySpecialMessage();
        // é‡ç½®ç‚¹å‡»è®¡æ•°
        state.clickTimestamps = [];
      } else {
        // æ™®é€šç‚¹å‡»æ˜¾ç¤ºçˆ±å¿ƒç‰¹æ•ˆ
        showHeartEffect();
      }
    }

    // æ˜¾ç¤ºç‚¹å‡»åé¦ˆ
    function showClickFeedback(x, y) {
      elements.tip.textContent = "ğŸ’˜ä¸€ç›´åœ¨æƒ³ä½ ğŸ’˜";
      elements.tip.style.left = x + 'px';
      elements.tip.style.top = y + 'px';
      elements.tip.classList.add('show');
      
      setTimeout(() => {
        elements.tip.classList.remove('show');
      }, 1000);
    }

    // åˆ›å»ºçƒŸèŠ±ç‰¹æ•ˆ
    function createFirework(x, y) {
      const firework = document.createElement('div');
      firework.className = 'firework';
      firework.style.left = x + 'px';
      firework.style.top = y + 'px';
      document.body.appendChild(firework);
      
      // åˆ›å»ºå¤šä¸ªç²’å­
      for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        particle.style.width = '6px';
        particle.style.height = '6px';
        particle.style.borderRadius = '50%';
        particle.style.background = `hsl(${Math.random() * 360}, 100%, 65%)`;
        particle.style.boxShadow = '0 0 8px currentColor';
        
        const angle = (i / 12) * Math.PI * 2;
        const distance = 50 + Math.random() * 50;
        const duration = 800 + Math.random() * 400;
        
        particle.style.transition = `all ${duration}ms ease-out`;
        firework.appendChild(particle);
        
        // è§¦å‘åŠ¨ç”»
        setTimeout(() => {
          particle.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
          particle.style.opacity = '0';
        }, 10);
      }
      
      // æ¸…ç†DOM
      setTimeout(() => {
        if (document.body.contains(firework)) {
          document.body.removeChild(firework);
        }
      }, 1500);
    }

    // æ˜¾ç¤ºçˆ±å¿ƒç‰¹æ•ˆ
    function showHeartEffect() {
      // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
      if (state.effectTimeout) {
        clearTimeout(state.effectTimeout);
      }
      
      // è®¾ç½®çˆ±å¿ƒå†…å®¹
      elements.effectText.textContent = "ğŸ’–";
      
      // ç¡®ä¿ç‰¹æ•ˆæ˜¯éšè—çŠ¶æ€
      elements.fullscreenEffect.classList.remove('active');
      
      // å¼ºåˆ¶é‡ç»˜
      void elements.fullscreenEffect.offsetWidth;
      
      // æ˜¾ç¤ºç‰¹æ•ˆ
      elements.fullscreenEffect.classList.add('active');
      
      // è®¾ç½®éšè—è¶…æ—¶
      state.effectTimeout = setTimeout(() => {
        elements.fullscreenEffect.classList.remove('active');
      }, 2000);
    }

    // æ˜¾ç¤ºæ¯å¤©ä¸åŒçš„ç‰¹æ®Šæ¶ˆæ¯
    function showDailySpecialMessage() {
      // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
      if (state.effectTimeout) {
        clearTimeout(state.effectTimeout);
      }
      
      // æ ¹æ®æ˜ŸæœŸå‡ é€‰æ‹©æ¶ˆæ¯ï¼ˆ0=å‘¨æ—¥ï¼Œ1=å‘¨ä¸€ï¼Œ...ï¼‰
      const today = new Date();
      const dayOfWeek = today.getDay();
      // å¦‚æœæ˜¯å‘¨æ—¥(0)ï¼Œä½¿ç”¨æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå¦åˆ™ä½¿ç”¨å¯¹åº”çš„æ¶ˆæ¯
      const messageIndex = dayOfWeek === 0 ? dailyMessages.length - 1 : dayOfWeek - 1;
      const dailyMessage = dailyMessages[messageIndex];
      
      // è®¾ç½®ç‰¹æ®Šæ¶ˆæ¯å†…å®¹
      elements.effectText.textContent = dailyMessage;
      
      // ç¡®ä¿ç‰¹æ•ˆæ˜¯éšè—çŠ¶æ€
      elements.fullscreenEffect.classList.remove('active');
      
      // å¼ºåˆ¶é‡ç»˜
      void elements.fullscreenEffect.offsetWidth;
      
      // æ˜¾ç¤ºç‰¹æ•ˆ
      elements.fullscreenEffect.classList.add('active');
      
      // è®¾ç½®éšè—è¶…æ—¶
      state.effectTimeout = setTimeout(() => {
        elements.fullscreenEffect.classList.remove('active');
      }, 4000); // ç‰¹æ®Šæ¶ˆæ¯æ˜¾ç¤ºæ—¶é—´æ›´é•¿
    }

    // å¯åŠ¨è®¡æ—¶å™¨
    function startTimer() {
      const startTime = new Date(CONFIG.startDate).getTime();
      
      function updateTimer() {
        const now = Date.now();
        const diff = now - startTime;
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        const milliseconds = diff % 1000;
        
        elements.days.textContent = days;
        elements.hours.textContent = hours.toString().padStart(2, '0');
        elements.minutes.textContent = minutes.toString().padStart(2, '0');
        elements.seconds.textContent = seconds.toString().padStart(2, '0');
        elements.milliseconds.textContent = milliseconds.toString().padStart(3, '0');
        
        requestAnimationFrame(updateTimer);
      }
      
      updateTimer();
    }

    // ä¾¿ç­¾åŠŸèƒ½
    function generateAllNotes() {
      const startDate = new Date(CONFIG.startDate);
      const today = new Date();
      const notes = [];
      
      // ç”Ÿæˆä»å¼€å§‹æ—¥æœŸåˆ°ä»Šå¤©çš„æ‰€æœ‰ä¾¿ç­¾
      let currentDate = new Date(startDate);
      while (currentDate <= today) {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth() + 1;
        const date = currentDate.getDate();
        const day = currentDate.getDay();
        const dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        
        // è®¡ç®—æƒ³ä½ çš„å¤©æ•°
        const diffTime = Math.abs(currentDate - startDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const dateStr = `${year}å¹´${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${dayNames[day]}`;
        const noteText = `ä»Šå¤©${month}æœˆ${date}æ—¥æ˜ŸæœŸ${dayNames[day]}ï¼Œæƒ³è€å©†çš„ç¬¬${diffDays}å¤©`;
        
        notes.push({
          date: dateStr,
          text: noteText,
          timestamp: currentDate.getTime()
        });
        
        // ä¸‹ä¸€å¤©
        currentDate.setDate(currentDate.getDate() + 1);
      }
      
      state.notes = notes.reverse(); // æœ€æ–°çš„åœ¨å‰é¢
      localStorage.setItem('loveNotes', JSON.stringify(state.notes));
    }

    function openNoteModal() {
      updateWeekDisplay();
      elements.noteModal.classList.add('active');
    }

    function closeNoteModal() {
      elements.noteModal.classList.remove('active');
    }

    function showPrevWeek() {
      if (state.currentWeek > 0) {
        state.currentWeek--;
        updateWeekDisplay();
      }
    }

    function showNextWeek() {
      const totalWeeks = Math.ceil(state.notes.length / 7);
      if (state.currentWeek < totalWeeks - 1) {
        state.currentWeek++;
        updateWeekDisplay();
      }
    }

    function updateWeekDisplay() {
      const startIndex = state.currentWeek * 7;
      const endIndex = startIndex + 7;
      const weekNotes = state.notes.slice(startIndex, endIndex);
      
      // æ›´æ–°å‘¨æ ‡é¢˜
      elements.weekTitle.textContent = `ç¬¬${state.currentWeek + 1}å‘¨`;
      
      // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
      elements.prevWeek.disabled = state.currentWeek === 0;
      const totalWeeks = Math.ceil(state.notes.length / 7);
      elements.nextWeek.disabled = state.currentWeek >= totalWeeks - 1;
      
      // æ›´æ–°ä¾¿ç­¾åˆ—è¡¨
      elements.noteList.innerHTML = '';
      
      if (weekNotes.length === 0) {
        const emptyItem = document.createElement('li');
        emptyItem.className = 'note-item';
        emptyItem.innerHTML = '<div class="note-text">æš‚æ— è®°å½•</div>';
        elements.noteList.appendChild(emptyItem);
      } else {
        weekNotes.forEach(note => {
          const noteItem = document.createElement('li');
          noteItem.className = 'note-item';
          noteItem.innerHTML = `
            <div class="note-date">${note.date}</div>
            <div class="note-text">${note.text}</div>
          `;
          elements.noteList.appendChild(noteItem);
        });
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('load', init);
  </script>
</body>
</html>
